# Execute Automation PRP

Execute a generated PRP to create a complete project structure in Notion with all tasks, dependencies, and relations configured.

## Usage

```
/execute-automation-prp PRPs/customer-portal-auth-system.md
```

## What This Command Does

1. **Validates PRP File** - Ensures complete and properly formatted
2. **Validates Notion MCP Connection** - Checks MCP tools available
3. **Creates Notion Structure** - Uses Notion MCP tools to create complete project structure
4. **Validates Notion Creation** - Verifies all pages and relations created
5. **Reports Success** - Provides Notion URLs and next steps

## Prerequisites

**Required:**
- ‚úÖ Notion MCP Server configured in Claude Code
- ‚úÖ Notion API token with access to workspace
- ‚úÖ Projects and Tasks databases shared with integration
- ‚úÖ Valid PRP file generated by `/generate-automation-prp`

**Setup Instructions:** See README.md section "Notion MCP Setup"

## Execution Steps

### Step 1: Validate PRP File

```bash
# Check file exists
test -f {provided_path}

# Check file is complete PRP (has required sections)
grep -q "## Project Structure" {file}
grep -q "## Detailed Task Breakdown" {file}
grep -q "## Dependency Graph" {file}
grep -q "## Timeline & Schedule" {file}
grep -q "## Notion Integration Plan" {file}
```

If validation fails:
- Alert user which sections are missing
- Suggest re-running `/generate-automation-prp`
- Exit gracefully

### Step 2: Read Complete PRP

```
Read: {provided_path}
```

Extract:
- Project name and metadata
- Complete project hierarchy
- All tasks with details (WBS, names, estimates, dates, assignments)
- All dependencies (from task to task, with types)
- Timeline information (start/end dates)
- Resource assignments

### Step 3: Validate Notion MCP

**Check MCP Tools Available:**
```
List available tools:
  - mcp__notion__create_page
  - mcp__notion__update_page
  - mcp__notion__query_database
  - (other notion tools)
```

If MCP tools NOT available:
```
‚ùå **Notion MCP Server Not Configured**

Please configure Notion MCP Server:

1. Create Notion integration: https://www.notion.so/profile/integrations
2. Copy API token (starts with ntn_)
3. Add to Claude Code config:

   For Claude Desktop (macOS):
   Edit: ~/Library/Application Support/Claude/claude_desktop_config.json

   Add:
   {
     "mcpServers": {
       "notionApi": {
         "command": "npx",
         "args": ["-y", "@notionhq/notion-mcp-server"],
         "env": {
           "NOTION_TOKEN": "your_token_here"
         }
       }
     }
   }

4. Restart Claude Code
5. Share Projects and Tasks databases with your integration
6. Run this command again

See README.md for detailed setup instructions.
```

**Exit if MCP not available.**

### Step 4: Get Notion Configuration

**Prompt user for database IDs (if not configured):**
```
To create project in Notion, I need your database IDs.

**Projects Database:**
1. Open your Projects database in Notion
2. Copy the database ID from URL:
   https://notion.so/{workspace}/{DATABASE_ID}?v=...
   (36-character ID between last slash and question mark)

Enter Projects Database ID: _______

**Tasks Database:**
Enter Tasks Database ID: _______

(These will be used for this execution only. To save permanently, add to .notion_config.json)
```

OR

**Read from config file (if exists):**
```
Read: .notion_config.json
{
  "projects_database_id": "...",
  "tasks_database_id": "..."
}
```

### Step 5: Create Notion Structure Using MCP Tools

**Use Notion MCP tools directly to create the structure:**

```
1. Create main project page:
   mcp__Notion__notion-create-pages(
     parent={"database_id": projects_db_id},
     pages=[{
       "properties": {
         "Name": "Project Title",
         "Status": "In Arbeit",
         "Priority": "High",
         ...
       }
     }]
   )

2. Create all subproject pages with parent relations:
   mcp__Notion__notion-create-pages(
     parent={"page_id": main_project_id},
     pages=[
       {"properties": {"Name": "Subproject 1", ...}},
       {"properties": {"Name": "Subproject 2", ...}},
       ...
     ]
   )

3. Create all task pages (first pass without dependencies):
   mcp__Notion__notion-create-pages(
     parent={"database_id": tasks_db_id},
     pages=[
       {"properties": {"Name": "Task 1.1", "Project": subproject_1_id, ...}},
       {"properties": {"Name": "Task 1.2", "Project": subproject_1_id, ...}},
       ...
     ]
   )

4. Setup all dependency relations (second pass):
   For each task with dependencies:
   mcp__Notion__notion-update-page(
     data={
       "page_id": task_id,
       "command": "update_properties",
       "properties": {
         "Dependencies": [predecessor_task_id_1, predecessor_task_id_2, ...]
       }
     }
   )

5. Validate complete structure:
   mcp__Notion__notion-fetch(id=main_project_id)
   mcp__Notion__notion-search(query=project_name)
```

**IMPORTANT:**
- Batch operations (10-20 pages per batch)
- Respect rate limits (3 req/sec)
- Implement retry logic for 429 errors
- Validate all pages and relations created

### Step 6: Wait for Completion

The Notion creation process will:
- Create all Notion pages
- Setup all relations
- Validate structure
- Return complete report

**Estimated Time:** 1-3 minutes (depending on project size)

For 50 tasks:
- Create projects: 10-20 seconds
- Create tasks: 30-60 seconds
- Setup dependencies: 20-30 seconds
- Validation: 10 seconds
- Total: ~90 seconds

### Step 7: Report Results to User

```markdown
‚úÖ **Notion Project Created Successfully!**

## Summary

**Project:** {Project Name}
**Main Project ID:** {notion_page_id}
**Created:**
- {X} projects/subprojects
- {Y} tasks
- {Z} dependency relations

## Notion Links

**üîó Main Project Page:**
https://notion.so/{workspace}/{main_project_id}

**üìä Projects Database:**
https://notion.so/{workspace}/{projects_database_id}

**‚úÖ Tasks Database:**
https://notion.so/{workspace}/{tasks_database_id}

**üìÖ Timeline View (Gantt):**
https://notion.so/{workspace}/{tasks_database_id}?v={timeline_view_id}

**üìã Kanban Board:**
https://notion.so/{workspace}/{tasks_database_id}?v={board_view_id}

## Validation Results

‚úÖ All projects created ({X}/{X})
‚úÖ All tasks created ({Y}/{Y})
‚úÖ All parent-child relations established
‚úÖ All task dependencies configured
‚úÖ Timeline view shows dependencies correctly
‚úÖ Properties calculating (progress, rollups)

## Next Steps

1. **Open your project in Notion:**
   - Click main project link above
   - Review project structure

2. **Review Timeline (Gantt Chart):**
   - Open Timeline view link
   - Verify schedule looks correct
   - Check dependencies are visible

3. **Configure Team:**
   - Assign team members to tasks
   - Set up Notion notifications
   - Configure user permissions

4. **Start Tracking Progress:**
   - Update task statuses as work progresses
   - Log actual hours in Actual Hours field
   - Mark tasks complete when done

5. **Monitor Project:**
   - Check Timeline view weekly for schedule
   - Review Kanban board for workflow
   - Monitor buffer consumption
   - Track critical path tasks daily

6. **Sync Progress Back (Optional):**
   - Use `/sync-notion-progress` to sync local updates to Notion
   - Keep Notion as single source of truth

## Tips

- **Timeline View:** Best for seeing critical path and schedule
- **Kanban Board:** Best for daily workflow management
- **Table View:** Best for detailed task information
- **Use Filters:** Create custom views for "My Tasks", "This Week", etc.
- **Set Reminders:** Configure Notion to remind you of upcoming deadlines

---

üéâ **Your automation project is now in Notion and ready to go!**
```

## Error Handling

### Error: Notion MCP Not Available

**Message:**
```
‚ùå Notion MCP Server not detected

[Provide setup instructions as shown in Step 3]
```

### Error: Database Not Accessible

**Message:**
```
‚ùå Cannot access Notion database

Error: 401 Unauthorized or 404 Not Found

Fix:
1. Open your database in Notion
2. Click "..." menu ‚Üí "Add connections"
3. Select your integration
4. Try command again

Affected database: {database_name} (ID: {db_id})
```

### Error: Rate Limited

**Behavior:**
- Subagent automatically retries with exponential backoff
- User sees progress updates
- Should succeed after retry

**If persistent:**
```
‚ö†Ô∏è Rate limit issues

Your project is large. Notion API allows 180 requests/minute.

Options:
1. Wait 5 minutes and run command again (will resume)
2. Create project in smaller batches (split INITIAL.md)

Current progress saved: {X} pages created, {Y} remaining
```

### Error: Invalid PRP Format

**Message:**
```
‚ùå PRP file is incomplete or malformed

Missing sections:
- {section 1}
- {section 2}

Please re-run: /generate-automation-prp {initial_file}
```

## Success Criteria

Notion project should have:
- ‚úÖ Main project page with all properties
- ‚úÖ All subprojects linked to main project
- ‚úÖ All tasks created and linked to projects
- ‚úÖ All dependencies configured as relations
- ‚úÖ Timeline view displaying Gantt chart
- ‚úÖ Kanban board showing workflow
- ‚úÖ Formulas calculating correctly (progress, etc.)
- ‚úÖ No orphaned pages
- ‚úÖ All validation checks passed

## Time Estimate

**Small Project (< 20 tasks):** 30-60 seconds
**Medium Project (20-50 tasks):** 1-2 minutes
**Large Project (50-100 tasks):** 2-4 minutes
**Very Large Project (100+ tasks):** 4-6 minutes

## Troubleshooting

### "Dependency relation failed"

**Cause:** Target task doesn't exist or database not shared

**Fix:**
- Ensure Tasks database is shared with integration
- Check that all tasks were created in first pass
- Re-run command (should resume from where it failed)

### "Formula not calculating"

**Cause:** Notion formulas need time to update

**Fix:**
- Wait 10-30 seconds
- Refresh Notion page
- Formulas should populate automatically

### "Timeline view not showing dependencies"

**Cause:** View not configured to show dependencies

**Fix:**
1. Open Timeline view in Notion
2. Click "..." menu ‚Üí "Layout"
3. Enable "Show dependencies"
4. Dependencies should now be visible as lines

---

**Version:** 1.0.0
**Last Updated:** 2025-01-10
